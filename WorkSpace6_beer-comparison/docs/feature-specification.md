# ビール比較機能 - 機能仕様書

## 1. 概要

### 1.1 機能の目的
本機能は、bier.jpにおいてユーザーが複数のビール商品を効率的に比較できるようにすることを目的としています。価格、容量、商品説明などの詳細情報を一覧表示することで、購入判断をサポートします。

### 1.2 対象ユーザー
- bier.jpでビールを購入検討しているお客様
- 複数の商品を比較して最適な選択をしたいユーザー
- ギフト用商品を探しているユーザー

## 2. ユーザーストーリー

### US-01: 商品の選択
**ユーザーとして**、商品リストから比較したいビールを選択したい。
**それにより**、興味のある商品を比較対象に追加できる。

**受け入れ条件:**
- チェックボックスをクリックして商品を選択できる
- 選択した商品は画面下部の「比較する商品一覧」に表示される
- 商品画像と商品名が表示される

### US-02: 選択上限の制御
**ユーザーとして**、比較商品数の上限を知りたい。
**それにより**、適切な数の商品を選択できる。

**受け入れ条件:**
- 最大4つまで商品を選択できる
- 5つ目を選択しようとするとアラートが表示される
- アラート後、チェックは自動的に解除される

### US-03: 商品の比較実行
**ユーザーとして**、選択した商品を一覧で比較したい。
**それにより**、価格や容量などを簡単に比較できる。

**受け入れ条件:**
- 「商品の比較をする」ボタンをクリックすると比較表が表示される
- 2つ以上の商品が選択されている必要がある
- 比較表には商品画像、商品名、価格、容量、ビール情報、URLが表示される

### US-04: 選択のクリア
**ユーザーとして**、選択をリセットしたい。
**それにより**、新たに比較をやり直すことができる。

**受け入れ条件:**
- 「クリア」ボタンをクリックすると全ての選択が解除される
- 比較する商品一覧が空になる
- セッションストレージもクリアされる

### US-05: 比較表の閉じる
**ユーザーとして**、比較表を閉じたい。
**それにより**、商品リストに戻って再選択できる。

**受け入れ条件:**
- 比較表右上の「×」ボタンで閉じることができる
- 選択状態は維持される

### US-06: セッション維持
**ユーザーとして**、ページをリロードしても選択状態を維持したい。
**それにより**、誤ってページを閉じても再選択の手間が省ける。

**受け入れ条件:**
- セッションストレージに選択情報が保存される
- ページ読み込み時に選択状態が復元される

## 3. 機能要件

### 3.1 商品選択機能

| 項目 | 仕様 |
|------|------|
| 選択方法 | チェックボックス |
| 最大選択数 | 4商品 |
| 選択超過時の動作 | アラート表示、チェック自動解除 |
| 選択解除 | 個別チェックボックスまたはクリアボタン |

### 3.2 比較表示機能

| 項目 | 仕様 |
|------|------|
| 最小比較数 | 2商品 |
| 表示項目 | 商品画像、商品名、価格、容量、ビール情報、URL |
| 1本あたり価格 | セット商品の場合、自動計算して表示 |
| データ取得 | bier.jp APIから非同期取得 |

### 3.3 比較表の表示項目詳細

| 列名 | 説明 | 取得元 |
|------|------|--------|
| 商品画像 | 商品のサムネイル画像 | チェックボックスのsrc属性 |
| 商品名 | 商品の正式名称（リンク付き） | チェックボックスのname属性 |
| 価格 | 販売価格（セット商品は1本あたり価格も表示） | API（Price） |
| 容量 | ビールの容量（ml） | 商品ページHTML（スクレイピング） |
| ビール情報 | 商品の説明文（整形済み） | API（Description） |
| URL | 商品ページへのリンク | チェックボックスのvalue属性 |

### 3.4 データ永続化

| 項目 | 仕様 |
|------|------|
| 保存先 | sessionStorage |
| 保存データ | 商品名をキー、URL・画像URLをJSON値として保存 |
| 復元タイミング | DOMContentLoaded イベント時 |

## 4. 非機能要件

### 4.1 パフォーマンス
- 商品データ取得はPromise.allで並列実行
- データ取得中は「データ取得中...」と表示し、ボタンを無効化

### 4.2 ユーザビリティ
- 選択した商品が画面下部に常時表示される
- 比較表は画面上部に固定表示
- モバイルデバイスでも操作可能なレスポンシブデザイン

### 4.3 互換性
- CORS対策としてプロキシサーバーを経由
- 不正なJSON形式（末尾カンマ）を自動修正

## 5. 制約事項

- CORSプロキシ（cors-anywhere.herokuapp.com）の利用制限に依存
- 商品ページのHTML構造変更時は容量取得ロジックの修正が必要
- セッションストレージはブラウザを閉じるとクリアされる

## 6. 将来の拡張案

1. **比較商品の永続化**: localStorageを利用したブラウザ再起動後の復元
2. **比較結果の共有**: URLパラメータによる比較結果の共有機能
3. **ソート機能**: 価格順、容量順などでの並び替え
4. **フィルター機能**: ビールスタイル、産地などでの絞り込み
5. **お気に入り連携**: 比較結果からお気に入りリストへの追加
