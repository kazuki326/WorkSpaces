# Work Space 3: LINEでの注文機能の実装

## 1. プロジェクト目標

ECサイト「bier.jp」の公式LINEアカウントにチャットボットを導入し、ユーザーがLINE上で商品を注文できる仕組みを構築する。これにより、ユーザー体験の向上と売上増加を目指す。

## 2. アーキテクチャ概要

Miroでの議論の結果、以下のアーキテクチャを採用する。

1.  **LINEチャットボット (Google Apps Script)**:
    *   ユーザーとの対話、商品レコメンドを担当する。
    *   LINE Messaging APIからのWebhookを受け取り、応答メッセージを生成する。

2.  **商品カード (Flex Message)**:
    *   チャットボットが商品を提案する際に、画像、説明、価格、アクションボタンを含むリッチなUI（商品カード）を送信する。

3.  **買い物かご追加API (`bier.jp`側)**:
    *   `bier.jp`のドメイン上に、外部から商品IDを受け取り、localStorageで管理されている買い物かごに商品を追加するためのAPIエンドポイントを新規に開発する。
    *   LINEの商品カードの「商品かごに追加」ボタンは、このAPIを呼び出すURLを指す。

4.  **決済と配送**:
    *   決済と配送先情報の入力は、既存の`bier.jp`のフローを利用する。ユーザーは買い物かごページに遷移し、そこで手続きを完了させる。

**補足:** 当初、LINE内での決済完結も検討されたが（L Message, Lea等の外部サービス利用）、既存の`bier.jp`のシステムとの連携の複雑さや在庫管理の二重化リスクを考慮し、まずは`bier.jp`サイトへの誘導とAPI連携を優先する方針とする。

## 3. 主な機能要件

- **チャットボットによる商品検索・推薦**: ユーザーのメッセージに基づき、商品を検索し、商品カードを送信する。
- **LINEアカウント連携**: `bier.jp`のアカウントとLINEアカウントを連携させ、シームレスな顧客体験を提供する。
- **リッチメニューの設置**: ユーザーがいつでも「買い物かご」や「トップページ」にアクセスできるメニューをLINEのトーク画面下部に常時表示する。
- **買い物かごへの追加機能**: LINEの商品カードからワンタップで`bier.jp`の買い物かごに商品を追加できる。

## 4. 技術的課題とTODO

- **`bier.jp`買い物かごAPIの開発**:
    - `bier.jp`のドメインで、商品IDをパラメータとして受け取り、localStorageの買い物かご情報を更新するAPIを実装する。
    - セキュリティ（CSRF対策など）を考慮する必要がある。
- **Google Apps Script (GAS) の実装**:
    - LINE Messaging APIのWebhook処理
    - 商品検索ロジック (`searchByProductName`)
    - 商品カード生成ロジック (`ConvertToProductCard`)
    - `bier.jp`の在庫情報や商品情報をGASから参照する方法の確立（SpreadsheetまたはAPI経由）
- **Flex Messageの最適化**:
    - 商品説明が長文の場合の省略表示 (`...`)
    - 画像のアスペクト比や表示品質の改善
- **LINEアカウント連携の実装**:
    - LINEのドキュメントに基づき、連携フローを設計・実装する。
- **エラーハンドリング**:
    - API呼び出しの失敗、商品が見つからない場合など、様々なエラーケースを想定した処理を実装する。

## 5. マーケティング施策

- LINE友だち登録を促進するためのWebサイト上のバナー設置やSNSでの告知。
- クーポン配布、新商品情報、セール情報などを通じたアクティブな情報発信。
